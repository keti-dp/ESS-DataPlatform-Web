<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <title>Dashboard</title>
    <!-- HTML5 Shim and Respond.js IE11 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 11]>
    	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    	<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    	<![endif]-->
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description"
        content="DashboardKit is made using Bootstrap 5 design framework. Download the free admin template & use it for your project.">
    <meta name="keywords"
        content="DashboardKit, Dashboard Kit, Dashboard UI Kit, Bootstrap 5, Admin Template, Admin Dashboard, CRM, CMS, Free Bootstrap Admin Template">
    <meta name="author" content="DashboardKit ">


    <!-- Favicon icon -->
    <link rel="icon" href="{% static 'images/favicon.svg' %}" type="image/x-icon">

    <!-- font css -->
    <link rel="stylesheet" href="{% static 'fonts/feather.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/material.css' %}">

    <!-- vendor css -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" id="main-style-link">

    <!-- bootstrap-datepicker css -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker3.min.css">

</head>

<body class="">
    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <!-- [ Pre-loader ] End -->
    <!-- [ Mobile header ] start -->
    <div class="pc-mob-header pc-header">
        <div class="pcm-logo">
            <img src="{% static 'images/logo.svg' %}" alt="" class="logo logo-lg">
        </div>
        <div class="pcm-toolbar">
            <a href="#!" class="pc-head-link" id="mobile-collapse">
                <div class="hamburger hamburger--arrowturn">
                    <div class="hamburger-box">
                        <div class="hamburger-inner"></div>
                    </div>
                </div>
            </a>
            <a href="#!" class="pc-head-link" id="headerdrp-collapse">
                <i data-feather="align-right"></i>
            </a>
            <a href="#!" class="pc-head-link" id="header-collapse">
                <i data-feather="more-vertical"></i>
            </a>
        </div>
    </div>
    <!-- [ Mobile header ] End -->

    <!-- [ navigation menu ] start -->
    <nav class="pc-sidebar ">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="{% url 'index' %}" class="b-brand">
                    <!-- ========   change your logo hear   ============ -->
                    <img src="{% static 'images/logo.svg' %}" alt="" class="logo logo-lg">
                    <img src="{% static 'images/logo-sm.svg' %}" alt="" class="logo logo-sm">
                </a>
            </div>
            <div class="navbar-content">
                <ul class="pc-navbar">
                    <li class="pc-item pc-caption">
                        <label>Navigation</label>
                    </li>
                    <li class="pc-item">
                        <a href="{% url 'dashboard' %}" class="pc-link "><span class="pc-micon"><i
                                    class="material-icons-two-tone">home</i></span><span
                                class="pc-mtext">Dashboard</span></a>
                    </li>
                    <li class="pc-item pc-caption">
                        <label>Pages</label>
                        <span>Redymade Pages</span>
                    </li>
                    <li class="pc-item pc-hasmenu">
                        <a href="#!" class="pc-link"><span class="pc-micon"><i
                                    class="material-icons-two-tone">https</i></span><span
                                class="pc-mtext">Authentication</span><span class="pc-arrow"><i
                                    data-feather="chevron-right"></i></span></a>
                        <ul class="pc-submenu">
                            <li class="pc-item"><a class="pc-link" href="auth-signup.html" target="_blank">Sign up</a>
                            </li>
                            <li class="pc-item"><a class="pc-link" href="auth-signin.html" target="_blank">Sign in</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- [ navigation menu ] end -->
    <!-- [ Header ] start -->
    <header class="pc-header ">
        <div class="header-wrapper">
            <div class="mr-auto pc-mob-drp">
                <ul class="list-unstyled">
                    <li class="dropdown pc-h-item">
                        <a class="pc-head-link active dropdown-toggle arrow-none mr-0" data-toggle="dropdown" href="#"
                            role="button" aria-haspopup="false" aria-expanded="false">
                            Level
                        </a>
                        <div class="dropdown-menu pc-h-dropdown">
                            <a href="#!" class="dropdown-item">
                                <i class="material-icons-two-tone">account_circle</i>
                                <span>My Account</span>
                            </a>
                            <div class="pc-level-menu">
                                <a href="#!" class="dropdown-item">
                                    <i class="material-icons-two-tone">list_alt</i>
                                    <span class="float-right"><i data-feather="chevron-right" class="mr-0"></i></span>
                                    <span>Level2.1</span>
                                </a>
                                <div class="dropdown-menu pc-h-dropdown">
                                    <a href="#!" class="dropdown-item">
                                        <i class="fas fa-circle"></i>
                                        <span>My Account</span>
                                    </a>
                                    <a href="#!" class="dropdown-item">
                                        <i class="fas fa-circle"></i>
                                        <span>Settings</span>
                                    </a>
                                    <a href="#!" class="dropdown-item">
                                        <i class="fas fa-circle"></i>
                                        <span>Support</span>
                                    </a>
                                    <a href="#!" class="dropdown-item">
                                        <i class="fas fa-circle"></i>
                                        <span>Lock Screen</span>
                                    </a>
                                    <a href="#!" class="dropdown-item">
                                        <i class="fas fa-circle"></i>
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                            <a href="#!" class="dropdown-item">
                                <i class="material-icons-two-tone">settings</i>
                                <span>Settings</span>
                            </a>
                            <a href="#!" class="dropdown-item">
                                <i class="material-icons-two-tone">support</i>
                                <span>Support</span>
                            </a>
                            <a href="#!" class="dropdown-item">
                                <i class="material-icons-two-tone">https</i>
                                <span>Lock Screen</span>
                            </a>
                            <a href="#!" class="dropdown-item">
                                <i class="material-icons-two-tone">chrome_reader_mode</i>
                                <span>Logout</span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="ml-auto">
                <ul class="list-unstyled">
                    <li class="dropdown pc-h-item">
                        <a class="pc-head-link dropdown-toggle arrow-none mr-0" data-toggle="dropdown" href="#"
                            role="button" aria-haspopup="false" aria-expanded="false">
                            <i class="material-icons-two-tone">search</i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right pc-h-dropdown drp-search">
                            <form class="px-3">
                                <div class="form-group mb-0 d-flex align-items-center">
                                    <i data-feather="search"></i>
                                    <input type="search" class="form-control border-0 shadow-none"
                                        placeholder="Search here. . .">
                                </div>
                            </form>
                        </div>
                    </li>
                    <li class="dropdown pc-h-item">
                        <a class="pc-head-link dropdown-toggle arrow-none mr-0" data-toggle="dropdown" href="#"
                            role="button" aria-haspopup="false" aria-expanded="false">
                            <img src="{% static 'images/user/avatar-2.jpg' %}" alt="user-image" class="user-avtar">
                            <span>
                                <span class="user-name">Joseph William</span>
                                <span class="user-desc">Administrator</span>
                            </span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right pc-h-dropdown">
                            <div class=" dropdown-header">
                                <h5 class="text-overflow m-0"><span class="badge bg-light-primary"><a
                                            href="https://gumroad.com/dashboardkit" target="_blank">Upgrade to
                                            Pro</a></span></h5>
                            </div>

                            <a href="auth-signin.html" class="dropdown-item">
                                <i class="material-icons-two-tone">chrome_reader_mode</i>
                                <span>Logout</span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>

        </div>
    </header>
    <!-- [ Header ] end -->

    <!-- [ Main Content ] start -->
    <div class="pc-container">
        <div class="pcoded-content">
            <!-- [ breadcrumb ] start -->
            <div class="page-header">
                <div class="page-block">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="page-header-title">
                                <h5 class="m-b-10">Dashboard sale</h5>
                            </div>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
                                <li class="breadcrumb-item">Dashboard sale</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ breadcrumb ] end -->
            <!-- [ Main Content ] start -->
            <div class="row">
                <div class="col-xl-6 col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>운영사이트1의 Bank의 기간별 배터리 시간당 평균 SoC</h5>
                        </div>
                        <div class="card-body">
                            <div class="col-md-3 offset-md-9">
                                <input type="text" id="avg-bank-soc-date-input" class="form-control"
                                    placeholder="날짜를 선택해주세요">
                            </div>
                            <div id="avg-bank-soc-chart" style="width: 100%; height: 400px;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6 col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>운영사이트1의 Rack의 기간별 배터리 시간당 평균 SoC</h5>
                        </div>
                        <div class="card-body">
                            <div id="avg-bank-soh-chart"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ Main Content ] end -->
        </div>
    </div>
    <!-- [ Main Content ] end -->
    <!-- Warning Section start -->
    <!-- Older IE warning message -->
    <!--[if lt IE 11]>
        <div class="ie-warning">
            <h1>Warning!!</h1>
            <p>You are using an outdated version of Internet Explorer, please upgrade
               <br/>to any of the following web browsers to access this website.
            </p>
            <div class="iew-container">
                <ul class="iew-download">
                    <li>
                        <a href="http://www.google.com/chrome/">
                            <img src="assets/images/browser/chrome.png" alt="Chrome">
                            <div>Chrome</div>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.mozilla.org/en-US/firefox/new/">
                            <img src="assets/images/browser/firefox.png" alt="Firefox">
                            <div>Firefox</div>
                        </a>
                    </li>
                    <li>
                        <a href="http://www.opera.com">
                            <img src="assets/images/browser/opera.png" alt="Opera">
                            <div>Opera</div>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.apple.com/safari/">
                            <img src="assets/images/browser/safari.png" alt="Safari">
                            <div>Safari</div>
                        </a>
                    </li>
                    <li>
                        <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">
                            <img src="assets/images/browser/ie.png" alt="">
                            <div>IE (11 & above)</div>
                        </a>
                    </li>
                </ul>
            </div>
            <p>Sorry for the inconvenience!</p>
        </div>
    <![endif]-->
    <!-- Warning Section Ends -->
    <!-- Required Js -->
    <script src="{% static 'js/vendor-all.min.js' %}"></script>
    <script src="{% static 'js/plugins/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/plugins/feather.min.js' %}"></script>
    <script src="{% static 'js/pcoded.min.js' %}"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script> -->
    <!-- <script src="assets/js/plugins/clipboard.min.js"></script> -->
    <!-- <script src="assets/js/uikit.min.js"></script> -->

    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <script>
        var avgBankSoCDatePicker = $('#avg-bank-soc-date-input').datepicker({
            format: 'yyyy-mm-dd',
            orientation: 'bottom',
            autoclose: true
        });
        avgBankSoCDatePicker.on('changeDate', () => {
            document.getElementById('avg-bank-soc-chart').innerHTML = '';
            let date = avgBankSoCDatePicker.val();

            var requestUrl = new URL(window.location.origin + '/api/ess/operation-sites/1/banks/1/stats/bank-avg-soc');
            requestUrl.searchParams.append('date', date);
            requestUrl.searchParams.append('time-bucket-width', '1hour');

            fetch(requestUrl).then(response => {
                return response.json();
            }).then(responseData => {
                // Create root and chart
                var root = am5.Root.new("avg-bank-soc-chart");

                root.setThemes([
                    am5themes_Animated.new(root)
                ]);

                var chart = root.container.children.push(
                    am5xy.XYChart.new(root, {
                        panY: false,
                        wheelY: "zoomX",
                        layout: root.verticalLayout,
                        maxTooltipDistance: 0
                    })
                );

                var data = [];

                responseData.forEach(element => {
                    let date = new Date(element.time).getTime()
                    let value = element.avg_bank_soc

                    data.push({ date: date, value: value });
                });

                // Create Y-axis
                var yAxis = chart.yAxes.push(
                    am5xy.ValueAxis.new(root, {
                        extraTooltipPrecision: 1,
                        max: 100,
                        renderer: am5xy.AxisRendererY.new(root, {})
                    })
                );

                // Create X-Axis
                let xAxis = chart.xAxes.push(
                    am5xy.DateAxis.new(root, {
                        baseInterval: { timeUnit: "hour", count: 1 },
                        renderer: am5xy.AxisRendererX.new(root, {})
                    })
                );

                xAxis.get("dateFormats")["hour"] = "HH:mm";
                xAxis.get("periodChangeDateFormats")["hour"] = "yyyy-MM-dd HH:mm";

                // Create series
                function createSeries(name, field) {
                    var series = chart.series.push(
                        am5xy.LineSeries.new(root, {
                            name: name,
                            xAxis: xAxis,
                            yAxis: yAxis,
                            valueYField: field,
                            valueXField: "date",
                            tooltip: am5.Tooltip.new(root, {})
                        })
                    );

                    series.bullets.push(function () {
                        return am5.Bullet.new(root, {
                            sprite: am5.Circle.new(root, {
                                radius: 5,
                                fill: series.get("fill")
                            })
                        });
                    });

                    series.strokes.template.set("strokeWidth", 2);

                    series.get("tooltip").label.set("text", "[bold]{name}[/]\n{valueX.formatDate('yyyy-MM-dd HH:mm')}: {valueY.formatNumber('#.000')}")
                    series.data.setAll(data);
                }

                createSeries("Series", "value");

                // Add cursor
                chart.set("cursor", am5xy.XYCursor.new(root, {
                    behavior: "zoomXY",
                    xAxis: xAxis
                }));

                xAxis.set("tooltip", am5.Tooltip.new(root, {
                    themeTags: ["axis"]
                }));

                yAxis.set("tooltip", am5.Tooltip.new(root, {
                    themeTags: ["axis"]
                }));
            }).catch(error => {
                console.log(error);
            });
        });
    </script>
</body>

</html>